<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Dly Blog</title>
    <description>关于程序与设计 | 柳燕，Software Engineer</description>
    <link>http://localhost:4000/</link>
    <atom:link href="http://localhost:4000/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Thu, 15 Aug 2019 10:44:34 +0800</pubDate>
    <lastBuildDate>Thu, 15 Aug 2019 10:44:34 +0800</lastBuildDate>
    <generator>Jekyll v3.8.5</generator>
    
      <item>
        <title>pregnancy</title>
        <description>&lt;p&gt;2018.11.1日，晚21:34分诞一女，名周尧，取简单大气之意，因11月1号生，故小名一一，也唤尧尧。&lt;/p&gt;

&lt;p&gt;今日是我第一日为母亲，其实感觉不大，后来我才明白，亲情也如爱情一般，是不知所起、一往而深的。&lt;/p&gt;

&lt;p&gt;感谢我给力的伴侣时刻照顾我包容我，感谢我自己如此坚强，感谢宝宝让我遇见你。&lt;/p&gt;

&lt;p&gt;生育整个过程其实相比其他妈妈很轻松，中午12点开始有点羊水，当时搞不清楚是羊水还是尿，吃完饭老公给我们打车去医院，到了后，他已等在门口了，带我们直接去急诊，办手续，等人推上去，等了一个多小时，幸好没宫缩，一直到晚上8点多开始宫缩，没过10分钟，宫缩就频繁了，推进产房，大概20来分钟就生出来了。&lt;/p&gt;

&lt;p&gt;第一眼看到宝宝睁着她的大眼睛到处好奇的看看，哈哈哈哈，护士说好漂亮的小孩，还让我亲了一口就抱走了，说实话当时并没有想亲你，只想看看你的手指脚趾都齐不，可是我没带眼镜，看不清…..&lt;/p&gt;

&lt;p&gt;这些经历大概不会再经历了……&lt;/p&gt;

&lt;p&gt;废话不说了，介绍点实用的清单吧。&lt;/p&gt;

&lt;h5 id=&quot;其他用品&quot;&gt;其他用品&lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;入院证件 1套★ 双方身份证、产检病历及围产卡、准生证、医保卡、生育保险凭证。&lt;/li&gt;
  &lt;li&gt;手机和充电器 1台★ 有情况可以随时和家人联系，另外也需要看时间来记录阵痛、宫缩时间。&lt;/li&gt;
  &lt;li&gt;银行卡和现金 足量★ 两者都需要准备，一定要带好现金，买点小东西的时候也方便。事先向医院了解清楚支付方式。&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;妈妈用品&quot;&gt;妈妈用品&lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;开襟睡衣 2套★&lt;/li&gt;
  &lt;li&gt;一次性内裤 10条★&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://baike.pcbaby.com.cn/qzbd/1125498.html&quot;&gt;产妇护理垫&lt;/a&gt; 10片★ 在最初的几天，剖腹产在手术前都要插导尿管，这时可用来隔恶露，保持床单干净。&lt;/li&gt;
  &lt;li&gt;成人纸尿裤 4-6片&lt;/li&gt;
  &lt;li&gt;拖鞋 1双★ 选择鞋底柔软、防滑的拖鞋;有亲人陪床的话，最好准备双人份。&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://baike.pcbaby.com.cn/qzbd/1110309.html&quot;&gt;哺乳文胸&lt;/a&gt; 2件★ 可以选择前开式或吊带开口式的，方便给宝宝喂奶，准备够住院时替换即可。&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://baike.pcbaby.com.cn/qzbd/8785.html&quot;&gt;产妇卫生巾&lt;/a&gt; 25片★ 产后私处易受细菌感染或有湿疹，一定要保持干爽清洁;&lt;/li&gt;
  &lt;li&gt;洗漱用品 1套★ 牙刷、梳子、脸盆、香皂、洗衣液若干。毛巾要准备2块。&lt;/li&gt;
  &lt;li&gt;餐具 1套 饭盒、筷子、杯子、勺子、还有带弯头的吸管，产后不能起身时，可用吸管喝水、喝汤，很方便。&lt;/li&gt;
  &lt;li&gt;妈妈食品 若干 可提前准备好巧克力等食品。巧克力可用于生产时增加体力。&lt;/li&gt;
  &lt;li&gt;出院衣服 1套 出院的时候可不是大肚子啦，所以应该准备一套适合出院当天穿的服装。&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;骨盆矫正带 1条★ 骨盆矫正带与一般束缚带不同，它使用的位置较低，作用是适度对骨盆施加向内的压力，促进它尽快恢复。  可选。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;月子帽   1顶&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;宝宝用品&quot;&gt;宝宝用品&lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://baike.pcbaby.com.cn/qzbd/1127018.html&quot;&gt;新生儿衣服&lt;/a&gt; 带肚衣2—4件。婴童连体衣2～4件，秋冬厚款。外套2套，宝宝外出穿。包被2条，外出时包裹宝宝用。&lt;/li&gt;
  &lt;li&gt;口水巾：5条。多多益善，宝宝溢奶用得着&lt;/li&gt;
  &lt;li&gt;帽子：帽子2个，外出时戴。&lt;/li&gt;
  &lt;li&gt;纸尿裤 30片★ 新生宝宝一天大概用8-10片NB码纸尿裤，所以先准备3天的量;如果纸尿裤好用的话，再继续买。     花王&lt;/li&gt;
  &lt;li&gt;奶瓶刷 1个 要彻底清洁奶瓶，不能随便冲洗，可以选择海绵刷头的奶瓶刷，加上奶瓶清洁剂进行涮洗。&lt;/li&gt;
  &lt;li&gt;抱被 2条★ 用于保暖；即使是夏天，宝宝睡觉也要遮盖小肚子，避免受凉导致肠道不适。&lt;/li&gt;
  &lt;li&gt;玻璃奶瓶 2个 应准备两种不同容量的宽口径玻璃奶瓶;无论是母乳喂养还是奶粉喂养都会用得上。    贝亲宽口带排气孔，玻璃&lt;/li&gt;
  &lt;li&gt;奶嘴：2个。小号、十字开口。奶嘴容易因为宝宝撕咬而破损。&lt;/li&gt;
  &lt;li&gt;配方奶粉 1罐 虽然新生宝宝最好是喂母乳，考虑到有些妈妈开奶困难或奶水不足，最好也先准备一罐配方奶粉。&lt;/li&gt;
  &lt;li&gt;洗漱用品 纯棉方巾4条，脸盆一个。&lt;/li&gt;
  &lt;li&gt;清洁用品   纸巾，湿巾&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;出院后用品&quot;&gt;出院后用品&lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;婴儿专用浴盆：1个。给宝宝洗澡用，避免交叉使用造成细菌感染。&lt;/li&gt;
  &lt;li&gt;婴儿专用脸盆：3个。洗脸，洗屁屁，洗衣服各一个，后面婆婆基本只用了一个。&lt;/li&gt;
  &lt;li&gt;洗澡带：1个。让宝宝躺在水中而不至于被水呛到。&lt;/li&gt;
  &lt;li&gt;婴儿露：1瓶。新生儿可以使用洗发和沐浴二合一的清洁产品，注意产品ph值要温和。&lt;/li&gt;
  &lt;li&gt;婴儿专用润肤露：1瓶。秋天天气开始干燥，娇嫩的皮肤更加需要滋润。&lt;/li&gt;
  &lt;li&gt;婴儿防静电洗衣液：1瓶。让宝宝衣物柔软，避免静电。&lt;/li&gt;
  &lt;li&gt;湿纸巾：婴儿专用，湿巾可以用于宝宝日常的清洁，如清洁鼻口和小屁屁。&lt;/li&gt;
  &lt;li&gt;指甲钳：婴儿专用，新生儿新陈代谢快，指甲很快就长出来了。要是不剪指甲，他们很容易在不经意间把自己抓伤。婴儿专用的指甲钳小巧而且不会太锋利，可以避免剪到宝宝的手指。&lt;/li&gt;
  &lt;li&gt;水温计：1个。医学上推荐水温在37℃-40℃左右比较合适，但光靠大人的手感测水温很不准确。用来婴儿水温计可以准确测量水温，让宝宝在舒服的水温中洗澡。&lt;/li&gt;
  &lt;li&gt;空气加湿器：1个。使空气保持湿润，避免干燥而引起宝宝呼吸道刺激，或者衣服上起静电。&lt;/li&gt;
  &lt;li&gt;额温枪&lt;/li&gt;
  &lt;li&gt;奶瓶消毒器带烘干&lt;/li&gt;
  &lt;li&gt;吸奶器&lt;/li&gt;
&lt;/ul&gt;

</description>
        <pubDate>Thu, 01 Nov 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2018/11/01/pregnancy/</link>
        <guid isPermaLink="true">http://localhost:4000/2018/11/01/pregnancy/</guid>
        
        <category>Life</category>
        
        
      </item>
    
      <item>
        <title>design mode</title>
        <description>&lt;p&gt;最近学习了下设计模式，收获颇多，好像有了诀窍去写高端大气上档次代码一样。所谓设计模式，大概就是有一个功能你在纠结如何布局时，应该静下心来思考的事情，再大一点，扩展到项目，亦是如此。&lt;/p&gt;

&lt;p&gt;先简单上一个图。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/In_post/design_mode.png&quot; alt=&quot;design_mode&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;工厂模式&quot;&gt;工厂模式&lt;/h5&gt;

&lt;p&gt;写点简单的代码来理解下，可看代码中的注释帮助理解。&lt;/p&gt;

&lt;p&gt;个人对这个模式理解是，一个工厂里有各种对象产品，产品功能大致相同，但是功能表现不一致。&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;nameA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;gender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'male'&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;nameB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;gender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'female'&lt;/span&gt;
  
&lt;span class=&quot;c1&quot;&gt;#工厂方法,后续需新增class，即可添加在此方法中。无需改变下面的流程代码。
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;name_factory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'nameA'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nameA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'nameB'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nameB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  
&lt;span class=&quot;c1&quot;&gt;#流程与class解耦
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ttA&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name_factory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'nameA'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ttB&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name_factory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'nameB'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;构造模式&quot;&gt;构造模式&lt;/h5&gt;

&lt;p&gt;这个模式针对一些复杂功能构造代码，就好比一台电脑有很多配置一样。&lt;/p&gt;

&lt;h5 id=&quot;单例模式&quot;&gt;单例模式&lt;/h5&gt;

&lt;p&gt;核心是一个class只有一个实例，每次创建实例时，如果已经创建过，将使用之前的实例，改写创建实例的__new__函数。&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;singleMd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;__new__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cls&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kwargs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;hasattr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cls&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'_instance'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;_instance&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__new__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cls&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kwargs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;cls&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_instance&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_instance&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cls&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_instance&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;singleMd&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;pass&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;c1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;c2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#is比较时，要求内存一致，而等于只要求值一致。
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;asset&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c1&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c2&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h5 id=&quot;装饰器模式&quot;&gt;装饰器模式&lt;/h5&gt;

&lt;p&gt;装饰器有很多介绍，在此不赘述了。&lt;/p&gt;

&lt;h5 id=&quot;适配器模式&quot;&gt;适配器模式&lt;/h5&gt;

&lt;p&gt;增加一个class，可以通过统一的接口调用不同实例里的不同方法。&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;adapter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adapter_functions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt;
    &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__dict__&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adapter_functions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;__getattr__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;getattr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;迭代模式&quot;&gt;迭代模式&lt;/h5&gt;

&lt;p&gt;迭代模式可以改写或者新加__iter__ 方法。&lt;/p&gt;

</description>
        <pubDate>Sat, 20 Oct 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2018/10/20/design-mode/</link>
        <guid isPermaLink="true">http://localhost:4000/2018/10/20/design-mode/</guid>
        
        <category>Skill</category>
        
        <category>Experience</category>
        
        
      </item>
    
      <item>
        <title>send email</title>
        <description>&lt;p&gt;​		一直觉得发送邮件再简单不过，直到最近深陷几个邮件大坑，费了不少时间才爬出来，当然其中也不乏公司环境给我挖的坑，代码不断，填坑不止呀……&lt;/p&gt;

&lt;p&gt;​		python发邮件主要是借助框架( 如Django)，以及pure python，其实底层都一样。&lt;/p&gt;

&lt;p&gt;​		借助Django，具体settings及发送邮件code如下：&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;EMAIL_HOST_USER&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'*****'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;DEFAULT_FROM_EMAIL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EMAIL_HOST_USER&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;EMAIL_FROM&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EMAIL_HOST_USER&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;EMAIL_HOST&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'smtp.partner.outlook.cn'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;EMAIL_HOST_PASSWORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'Pul13448'&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;＃看邮箱配置&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;EMAIL_PORT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;587&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;＃看邮箱配置&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;EMAIL_USE_TLS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;EMAIL_BACKEND&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'django.core.mail.backends.smtp.EmailBackend'&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;django.core.mail&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EmailMessage&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;os&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;send_mail_attachment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;subject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[],&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attach_file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;email&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EmailMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;subject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;from_email&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DEFAULT_FROM_EMAIL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;attach_file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;os&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BASE_DIR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attach_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attach_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attach_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fail_silently&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'send mail success,mail attachment:{}'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attach_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;logger&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;pure python,这里介绍通过thread发送，如下：&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;EmailThreadPure&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threading&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;subject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fail_silently&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;html_message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;smtpserver&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EMAIL_HOST&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EMAIL_HOST_USER&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sender&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EMAIL_HOST_USER&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;receiver&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;settings&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ADMINS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;body&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;subject&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;subject&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;html_message&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;html_message&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;threading&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;attach&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
      &lt;span class=&quot;s&quot;&gt;&quot;&quot;&quot;if attachment,use it&quot;&quot;&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;ctype&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mimetypes&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;guess_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attach_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ctype&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;ctype&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;application/octet-stream&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;maintype&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;subtype&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ctype&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maintype&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;text&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attach_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;rb&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;# Note: we should handle calculating the charset
&lt;/span&gt;                &lt;span class=&quot;n&quot;&gt;attachment&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MIMEText&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_subtype&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;subtype&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maintype&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;image&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attach_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;rb&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;attachment&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MIMEImage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_subtype&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;subtype&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maintype&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;audio&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attach_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;rb&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;attachment&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MIMEAudio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_subtype&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;subtype&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attach_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;rb&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;attachment&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MIMEBase&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;maintype&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;subtype&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;attachment&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;set_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;encoders&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encode_base64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attachment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;encoders&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encode_base64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attachment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;attachment&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add_header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Content-Disposition&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;attachment&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attach_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attach&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attachment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;# use html and plain mode,if no html,just self.msg = MIMEMultipart()
&lt;/span&gt;        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MIMEMultipart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'alternative'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'Subject'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;s'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;settings&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EMAIL_SUBJECT_PREFIX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;subject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'utf-8'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'from'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EMAIL_HOST_USER&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;# msg[to] is a string
&lt;/span&gt;        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'to'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;', '&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;receiver&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attach&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MIMEText&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'plain'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'utf-8'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attach&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MIMEText&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;html_message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'html'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'utf-8'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;smtplib&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SMTP&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;smtpserver&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EMAIL_PORT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;#debug mode
&lt;/span&gt;        &lt;span class=&quot;c1&quot;&gt;# server.set_debuglevel(1)
&lt;/span&gt;        
        &lt;span class=&quot;c1&quot;&gt;# USE TLS
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ehlo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;starttls&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;# if need login
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;login&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EMAIL_HOST_USER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EMAIL_HOST_PASSWORD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;#self.receiver is a list
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendmail&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;receiver&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;as_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;quit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;列坑&quot;&gt;列坑&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;DEFAULT_FROM_EMAIL与send mail中的from_email不一致。&lt;/p&gt;

    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;error info&lt;/code&gt;：&lt;/p&gt;

    &lt;p&gt;SMTPDataError: (554, ‘5.2.0 STOREDRV.Submission.Exception:SendAsDeniedException.MapiExceptionSendAsDenied; Failed to process message due to a permanent exception with message Cannot submit message.&lt;/p&gt;

    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;fix&lt;/code&gt;：统一DEFAULT_FROM_EMAIL与send mail中的from_email&lt;/p&gt;

    &lt;p&gt;应该使用tsl时，未设置tsl。
&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;error info&lt;/code&gt;：AUTH extension not supported by server&lt;/p&gt;

    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;fix&lt;/code&gt;：设置tsl，settings设置或者&lt;/p&gt;

    &lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;mail&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ehlo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;mail&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;starttls&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;&lt;br /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;python pure发邮件时，当多个收件人，可能只有第一个收件人能收到。&lt;/p&gt;

    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;error info&lt;/code&gt;:无，但会发现只有第一个人收到。&lt;/p&gt;

    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;fix&lt;/code&gt;：因为self.receiver为str的时候，会自动截取第一个。&lt;/p&gt;

    &lt;p&gt;​	    self.msg[‘to’] = ‘, ‘.join(self.receiver)&lt;/p&gt;

    &lt;p&gt;​        server.sendmail(self.sender, self.receiver, self.msg.as_string())&lt;/p&gt;

    &lt;p&gt;​        self.receiver为list
&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;如果settings配置错误，很有可能是不会报错并且返回发送邮件数量也为1，但实际上是收不到邮件，检查端口号及tsl和ssl 配置。我碰到的情况时logger中设置的mail setting与Django setting backend不一样，加上公司邮箱设置问题，导致mail setting 里的邮件发不出来。
&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;未设置timeout时间，导致一直在connect mail server，无log，会误认为已经发送好了。
&lt;code class=&quot;highlighter-rouge&quot;&gt;error info&lt;/code&gt;: 无，退出时会出现connect timeout，否则会一直连接。
&lt;code class=&quot;highlighter-rouge&quot;&gt;fix&lt;/code&gt;：设置timeout时间。
     可以使用telnet server port方式看是否连接有问题。
&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;避开敏感词汇，否则也可能会报554错误，如test等。&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

</description>
        <pubDate>Wed, 08 Aug 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2018/08/08/send-mail/</link>
        <guid isPermaLink="true">http://localhost:4000/2018/08/08/send-mail/</guid>
        
        <category>Skill</category>
        
        <category>Bugs</category>
        
        <category>Experience</category>
        
        
      </item>
    
      <item>
        <title>nginx 502 bad gateway error</title>
        <description>&lt;p&gt;请原谅我接下来可能要用不太平和的语气讲述下这段不太顺心的解bug之旅。&lt;/p&gt;

&lt;h4 id=&quot;前奏&quot;&gt;前奏：&lt;/h4&gt;

&lt;p&gt;​		我开发的网站之前一切都顺畅，测试环境和release环境都用过很久没有出现如此不稳定，有一段时间没用过后，最近项目上突然急用，当我默认它很稳定，跟领导保证更新一个功能1个小时就完成后，事情就发生了。&lt;/p&gt;

&lt;p&gt;​		接着我开启解bug之旅，然后我用了一天解完，期间领导半个小时过来问一次，问到后面我已经心虚的不敢回答了……&lt;/p&gt;

&lt;h4 id=&quot;bug描述&quot;&gt;bug描述：&lt;/h4&gt;
&lt;p&gt;​		无故会出现无法连接此网站，然后又无故好了，如此循环,可以看到iptables中docker映射端口会无缘无故missing.&lt;/p&gt;

&lt;p&gt;​		无故会出现502 bad gateway,后台看docker logs就是下面这个问题，然后又无故好了，如此循环；&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;2019/06/26 16:43:11 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;error] 457#457: &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;20 recv&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; failed &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;104: Connection reset by peer&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;while &lt;/span&gt;reading response header from upstream, client: 10.21.242.68, server: proxy, request: &lt;span class=&quot;s2&quot;&gt;&quot;GET /admin/ HTTP/1.1&quot;&lt;/span&gt;, upstream: &lt;span class=&quot;s2&quot;&gt;&quot;uwsgi://***&quot;&lt;/span&gt;, host: &lt;span class=&quot;s2&quot;&gt;&quot;***&quot;&lt;/span&gt;, referrer: &lt;span class=&quot;s2&quot;&gt;&quot;http://***/&quot;&lt;/span&gt;
2019/06/26 16:43:11 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;warn] 457#457: &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;20 upstream server temporarily disabled &lt;span class=&quot;k&quot;&gt;while &lt;/span&gt;reading response header from upstream, client: 10.21.242.68, server: proxy, request: &lt;span class=&quot;s2&quot;&gt;&quot;GET /admin/ HTTP/1.1&quot;&lt;/span&gt;, upstream: &lt;span class=&quot;s2&quot;&gt;&quot;uwsgi://****&quot;&lt;/span&gt;, host: &lt;span class=&quot;s2&quot;&gt;&quot;***&quot;&lt;/span&gt;, referrer: &lt;span class=&quot;s2&quot;&gt;&quot;http://***/&quot;&lt;/span&gt;
10.21.242.68 - - &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;26/Jun/2019:16:43:11 +0800] &lt;span class=&quot;s2&quot;&gt;&quot;GET /admin/ HTTP/1.1&quot;&lt;/span&gt; 502 575 &lt;span class=&quot;s2&quot;&gt;&quot;http://***/&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;-&quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;尝试解决方法&quot;&gt;尝试解决方法&lt;/h4&gt;

&lt;h5 id=&quot;增加nginx-各种buffer-size增加各种timeout&quot;&gt;增加nginx 各种buffer size，增加各种timeout&lt;/h5&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;proxy_connect_timeout 180&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
proxy_send_timeout 180&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
proxy_read_timeout 180&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
proxy_buffer_size 8k&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
proxy_buffers 4 64k&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
proxy_busy_buffers_size 128k&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
proxy_temp_file_write_size 128k
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;增加nginx-server-配置里max_failsfail_timeout&quot;&gt;增加nginx server 配置里max_fails,fail_timeout&lt;/h5&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;upstream backend_server &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    server &lt;span class=&quot;k&quot;&gt;***&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;max_fails&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;2 &lt;span class=&quot;nv&quot;&gt;fail_timeout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;10s &lt;span class=&quot;nv&quot;&gt;weight&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    server &lt;span class=&quot;k&quot;&gt;***&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;max_fails&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;2 &lt;span class=&quot;nv&quot;&gt;fail_timeout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;10s &lt;span class=&quot;nv&quot;&gt;weight&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;增加与后端的长连接&quot;&gt;增加与后端的长连接&lt;/h5&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;upstream  backend_server &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    server &lt;span class=&quot;k&quot;&gt;***&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;max_fails&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;2 &lt;span class=&quot;nv&quot;&gt;fail_timeout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;10s &lt;span class=&quot;nv&quot;&gt;weight&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    server &lt;span class=&quot;k&quot;&gt;***&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;max_fails&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;2 &lt;span class=&quot;nv&quot;&gt;fail_timeout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;10s &lt;span class=&quot;nv&quot;&gt;weight&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    keepalive 300&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;server &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        location /  &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            proxy_http_version 1.1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; // 这两个最好也设置
            proxy_set_header Connection &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;重启dockernginx&quot;&gt;重启docker，nginx；&lt;/h5&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;docker restart &lt;span class=&quot;k&quot;&gt;*****&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

nginx &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; reload&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h5 id=&quot;uwsgi-ini-buffer-size设为最大&quot;&gt;uwsgi .ini buffer-size设为最大；&lt;/h5&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;buffer-size     &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 65535
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;重点是以上皆失败。&lt;/p&gt;

&lt;h4 id=&quot;最终解决方式&quot;&gt;最终解决方式&lt;/h4&gt;

&lt;p&gt;引入了传说中重来一次大法，直接在之前的image上重新run了一个docker，一切皆解决了…….哭哭……..&lt;/p&gt;
</description>
        <pubDate>Wed, 01 Aug 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2018/08/01/502-bad-gateway/</link>
        <guid isPermaLink="true">http://localhost:4000/2018/08/01/502-bad-gateway/</guid>
        
        <category>ENV</category>
        
        <category>Skill</category>
        
        
      </item>
    
      <item>
        <title>Docker</title>
        <description>&lt;h4 id=&quot;docker的主要用途&quot;&gt;docker的主要用途&lt;/h4&gt;

&lt;p&gt;&lt;strong&gt;提供一次性的环境。&lt;/strong&gt;比如，本地测试他人的软件、持续集成的时候提供单元测试和构建的环境。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;提供弹性的云服务。&lt;/strong&gt;因为 Docker 容器可以随开随关，很适合动态扩容和缩容。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;组建微服务架构。&lt;/strong&gt;&lt;/p&gt;

&lt;h4 id=&quot;docker-principle&quot;&gt;docker principle&lt;/h4&gt;

&lt;p&gt;&lt;strong&gt;Linux 容器的一种封装，提供简单易用的容器使用接口&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;需要用户具有 sudo 权限&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;服务器—-客户端架构&lt;/strong&gt;&lt;/p&gt;

&lt;h4 id=&quot;docker-using&quot;&gt;docker using&lt;/h4&gt;

&lt;p&gt;可docker hub里抓取images；&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;docker image pull &lt;span class=&quot;k&quot;&gt;***&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;如mysql docker及redis docker&lt;/p&gt;

&lt;h4 id=&quot;新建dockerignore&quot;&gt;新建.dockerignore&lt;/h4&gt;

&lt;p&gt;里面填写的路径要排除，不打包进入 image 文件&lt;/p&gt;

&lt;h4 id=&quot;创建-dockerfile-文件生成image&quot;&gt;创建 Dockerfile 文件生成image&lt;/h4&gt;

&lt;p&gt;如下例子：&lt;/p&gt;

&lt;div class=&quot;language-dockerfile highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;＃继承image,也可继承官方的image，建议先pull下来
&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; django:1.9.6-python2&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;MAINTAINER&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; Liuyan Deng &amp;lt;mail_address&amp;gt;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#设置环境变量代理&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#ENV HTTP_PROXY ***&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#ENV HTTPS_PROXY ***&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#ENV FTP_PROXY ***&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#ENV http_proxy ***&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#ENV https_proxy ***&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#ENV ftp_proxy ***&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; environment test&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#安装包&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;apt-get update &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; apt-get &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;        ca-certificates &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;        vim &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;        cron &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;        curl &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;        libsasl2-dev &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;        libldap2-dev &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;        libssl-dev &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;        &lt;span class=&quot;nt&quot;&gt;--no-install-recommends&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-rf&lt;/span&gt; /var/lib/apt/lists/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;ADD&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; requirements.txt /opt/&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#可run一些安装包&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; /usr/lib/jvm
&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cp&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; /opt/jdk1.8.0_121 /usr/lib/jvm

&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /opt &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; unzip instantclient-basic-linux.x64-11.2.0.4.0.zip &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    unzip instantclient-sdk-linux.x64-11.2.0.4.0.zip &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    &lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /opt/instantclient_11_2 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    &lt;span class=&quot;nb&quot;&gt;ln&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; libclntsh.so.11.1 libclntsh.so

&lt;span class=&quot;c&quot;&gt;#RUN pip install --upgrade pip&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;pip &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; /opt/requirements.txt

&lt;span class=&quot;k&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; DB_NAME1 tmp&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; DB_USER1 tmp&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; DB_PASSWORD1 tmp&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; DB_HOST1 tmp&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; DB_PORT1 tmp&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; REDIS redis://***&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Asia/Shanghai&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /etc/timezone
&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;dpkg-reconfigure &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; noninteractive tzdata

&lt;span class=&quot;k&quot;&gt;WORKDIR&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; /opt/code_dir/&lt;/span&gt;

＃添加当前文件夹入docker，也可在docker run的时候通过-v映射，这样可直接reload更新代码
#ADD api api/
#ADD media media/
#ADD project project/
#ADD static static/
#ADD status status/
#ADD templates templates/
#ADD manage.py manage.py

&lt;span class=&quot;k&quot;&gt;ADD&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; resources/uwsgi/supervisord.conf /etc/supervisord.conf&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;ADD&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; resources/uwsgi/uwsgi.ini /opt/uwsgi.ini&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;ADD&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; resources/uwsgi/celerybeat.conf /etc/celerybeat.conf&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;ADD&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; resources/uwsgi/run-app.sh /run-app.sh&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;chmod &lt;/span&gt;u+x /run-app.sh

&lt;span class=&quot;k&quot;&gt;VOLUME&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; /media&lt;/span&gt;

＃将容器 9090 端口暴露出来， 允许外部连接这个端口
&lt;span class=&quot;k&quot;&gt;EXPOSE&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; 9090&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# run celery by root&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; C_FORCE_ROOT true&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; /opt/log

&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;CMD&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; /run-app.sh&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;docker-command&quot;&gt;docker command&lt;/h4&gt;

&lt;h5 id=&quot;docker-image-build&quot;&gt;docker image build&lt;/h5&gt;

&lt;p&gt;-t&lt;code class=&quot;highlighter-rouge&quot;&gt;参数用来指定 image 文件的名字，后面还可以用冒号指定标签。如果不指定，默认的标签就是&lt;/code&gt;latest`。最后的那个点表示 Dockerfile 文件所在的路径&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;docker image build &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; koa-demo:0.0.1 &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;docker-images&quot;&gt;docker images&lt;/h5&gt;

&lt;p&gt;-a 参数表示显示隐藏image&lt;/p&gt;

&lt;h5 id=&quot;docker-container-run&quot;&gt;docker container run&lt;/h5&gt;

&lt;p&gt;-p: 端口映射&lt;/p&gt;

&lt;p&gt;-e: 设置环境变量&lt;/p&gt;

&lt;p&gt;-v：路径映射&lt;/p&gt;

&lt;p&gt;—name: container name&lt;/p&gt;

&lt;p&gt;—tmpfs:临时文件系统&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;docker run &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; 9091:9090 &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;DB_NAME1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;***&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;DB_USER1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;***&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;DB_PASSWORD1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;mrcf4034vpfr &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;DB_HOST1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;10.80.121.169 &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;DB_PORT1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1521  &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;DB_NAME2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;***&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;DB_USER2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;***&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;DB_PASSWORD2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;***&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;DB_HOST2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;***&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;DB_PORT2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1521 &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;USERNAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;PASSWORD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;JOBNAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;***&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;REDIS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;redis://&lt;span class=&quot;k&quot;&gt;***&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;CSA_USERNAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;***&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;CSA_PASSWORD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;***&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;production &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;NO_PROXY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;****&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; local_path:docker_path  &lt;span class=&quot;nt&quot;&gt;--tmpfs&lt;/span&gt; /var/tmp/ &lt;span class=&quot;nt&quot;&gt;--tmpfs&lt;/span&gt; /tmp/ &lt;span class=&quot;nt&quot;&gt;--tmpfs&lt;/span&gt; /run/ &lt;span class=&quot;nt&quot;&gt;--name&lt;/span&gt; container_name image_name
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;docker--iptables&quot;&gt;docker &amp;amp; iptables&lt;/h4&gt;

&lt;p&gt;容器之间相互访问，需要两方面的支持。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;容器的网络拓扑是否已经互联。默认情况下，所有容器都会被连接到 &lt;code class=&quot;highlighter-rouge&quot;&gt;docker0&lt;/code&gt; 网桥上。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;本地系统的防火墙软件 – &lt;code class=&quot;highlighter-rouge&quot;&gt;iptables&lt;/code&gt; 是否允许通过。&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;访问所有端口&lt;/p&gt;

&lt;p&gt;当启动 Docker 服务（即 dockerd）的时候，默认会添加一条转发策略到本地主机 iptables 的 FORWARD 链上。策略为通过（&lt;code class=&quot;highlighter-rouge&quot;&gt;ACCEPT&lt;/code&gt;）还是禁止（&lt;code class=&quot;highlighter-rouge&quot;&gt;DROP&lt;/code&gt;）取决于配置&lt;code class=&quot;highlighter-rouge&quot;&gt;--icc=true&lt;/code&gt;（缺省值）还是 &lt;code class=&quot;highlighter-rouge&quot;&gt;--icc=false&lt;/code&gt;。当然，如果手动指定 &lt;code class=&quot;highlighter-rouge&quot;&gt;--iptables=false&lt;/code&gt; 则不会添加 &lt;code class=&quot;highlighter-rouge&quot;&gt;iptables&lt;/code&gt; 规则。&lt;/p&gt;

&lt;p&gt;可见，默认情况下，不同容器之间是允许网络互通的。如果为了安全考虑，可以在 &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/docker/daemon.json&lt;/code&gt; 文件中配置 &lt;code class=&quot;highlighter-rouge&quot;&gt;{&quot;icc&quot;: false}&lt;/code&gt; 来禁止它。&lt;/p&gt;

&lt;p&gt;iptables -nL :查看当前系统的规则&lt;/p&gt;
</description>
        <pubDate>Sat, 28 Jul 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2018/07/28/docker/</link>
        <guid isPermaLink="true">http://localhost:4000/2018/07/28/docker/</guid>
        
        <category>ENV</category>
        
        <category>Skill</category>
        
        
      </item>
    
      <item>
        <title>Vim</title>
        <description>&lt;blockquote&gt;
  &lt;p&gt;“这只是基础篇，后续有空再加进阶篇吧”&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;首先编辑vimrc，一般编辑用户级vimrc进行vim通用设置，再介绍了vim的一些基础命令及知识。
一般可在命令模式下使用help命令查看.&lt;/p&gt;

&lt;h4 id=&quot;vimrc&quot;&gt;vimrc&lt;/h4&gt;

&lt;p&gt;vim ~/.vimrc&lt;/p&gt;

&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;c&quot;&gt;&quot; you can add vim config here&lt;/span&gt;
syntax enable
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; background&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;dark&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;colorscheme&lt;/span&gt; solarized
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; nocompatible
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;number&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; ruler
&lt;span class=&quot;c&quot;&gt;&quot; highlight search matches&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; hlsearch
&lt;span class=&quot;c&quot;&gt;&quot; enable incremental searching&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; incsearch
&lt;span class=&quot;c&quot;&gt;&quot; set ignorecase when searching&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; ignorecase
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; smartcase
&lt;span class=&quot;c&quot;&gt;&quot; turn on file backups&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; backup
&lt;span class=&quot;c&quot;&gt;&quot; don't line wrap mid-word&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; lbr
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; autoindent
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; smartindent
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; expandtab
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; smartindent
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; shiftwidth&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; tabstop&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;&quot; display the incomplete commands in the bottom right-side screen&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; showcmd
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; wildmenu
&lt;span class=&quot;c&quot;&gt;&quot; set shortcut key&lt;/span&gt;
map &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;F3&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;ul&lt;span class=&quot;p&quot;&gt;&amp;gt;&amp;lt;&lt;/span&gt;CR&lt;span class=&quot;p&quot;&gt;&amp;gt;&amp;lt;&lt;/span&gt;space&lt;span class=&quot;p&quot;&gt;&amp;gt;&amp;lt;&lt;/span&gt;space&lt;span class=&quot;p&quot;&gt;&amp;gt;&amp;lt;&lt;/span&gt;li&lt;span class=&quot;p&quot;&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/li&amp;gt;&amp;lt;CR&amp;gt;&amp;lt;Esc&amp;gt;I&amp;lt;/&lt;/span&gt;ul&lt;span class=&quot;p&quot;&gt;&amp;gt;&amp;lt;&lt;/span&gt;Esc&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;Kcit
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;四种模式&quot;&gt;四种模式&lt;/h4&gt;

&lt;p&gt;简单模式&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;移查删改
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;可视化模式&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;对整块区域进行操作，如整体注释
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;插入模式&lt;/p&gt;

&lt;p&gt;命令模式&lt;/p&gt;

&lt;h4 id=&quot;常用命令&quot;&gt;常用命令&lt;/h4&gt;
&lt;h5 id=&quot;复制粘贴删除&quot;&gt;复制粘贴删除&lt;/h5&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;dd：剪切当前行，delete
ndd：n表示大于1的数字，剪切n行 
d$：从当前光标剪切到行末 
d0：从当前光标位置（不包括光标位置）剪切之行首
dw: 删除一个单词
yy：复制当前行,yank
p/P:粘贴在光标后／前，paste或者put
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;跳转&quot;&gt;跳转&lt;/h5&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;w/W:  跳转单词首字母，word
b/B: 反跳转，backward
e/E: 跳转单词最后一个字母，end
ge： 反跳转单词最后一个字母

NG → 到第 N 行 （陈皓注：注意命令中的G是大写的，另我一般使用 : N 到第N行，如 :137 到第137行） 
gg → 到第一行。（陈皓注：相当于1G，或 :1） 
G → 到最后一行。
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;查找&quot;&gt;查找&lt;/h5&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;/{char}：命令行查找
dt{char}:删除光标与查找字符间的字符
F/f{char}:反向／正向查找单个字符
t{char}：查找字符的前一个字符

% : 匹配括号移动，包括 (, {, [. （你需要把光标先移到括号上） 
\* 和 #:  匹配光标当前所在的单词，移动光标到下一个（或上一个）匹配单词（*是下一个，#是上一个） ##### 替换
s/go/roll/g:当前行所有go替换成roll
%s/go/roll/g:所有go替换成roll
shift+r/R:替换模式
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;缩进&quot;&gt;缩进&lt;/h5&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;:3,231&amp;gt; : 第3行到第231行缩进
&amp;lt;反缩进
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;注释&quot;&gt;注释&lt;/h5&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;多行注释： 
\1. 进入命令行模式，按ctrl + v进入 visual block模式（可视快模式），然后按j, 或者k选中多行，把需要注释的行标记起来 
\2. 按大写字母i，再插入注释符，例如// 
\3. 按esc键就会全部注释了（我的是按两下） 
取消多行注释： 
\1. 进入命令行模式，按ctrl + v进入 visual block模式（可视快模式），按小写字母L横向选中列的个数，例如 // 需要选中2列 
\2. 按字母j，或者k选中注释符号 
\3. 按d键就可全部取消注释 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;寄存器&quot;&gt;寄存器&lt;/h5&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;:reg 查看寄存器
无名寄存器：最后一条指令
数字寄存器：缓存最近10次，0是复制专用
有名寄存器：&quot;ayy，复制这一行内容存入a寄存器
黑洞寄存器
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</description>
        <pubDate>Thu, 05 Jul 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2018/07/05/vim/</link>
        <guid isPermaLink="true">http://localhost:4000/2018/07/05/vim/</guid>
        
        <category>ENV</category>
        
        <category>Skill</category>
        
        
      </item>
    
      <item>
        <title>Nginx</title>
        <description>&lt;p&gt;介绍nginx一些知识点，最后给出实战例子；&lt;/p&gt;

&lt;h4 id=&quot;nginx简单使用&quot;&gt;nginx简单使用&lt;/h4&gt;

&lt;p&gt;修改配置文件nginx.conf；&lt;/p&gt;

&lt;p&gt;nginx -s reload 重新加载(Nginx热部署)&lt;/p&gt;

&lt;p&gt;nginx -t检查配置&lt;/p&gt;

&lt;p&gt;nginx -s stop&lt;/p&gt;

&lt;h4 id=&quot;正向代理与反向代理&quot;&gt;正向代理与反向代理&lt;/h4&gt;

&lt;p&gt;nginx,经常被提及反向代理服务器功能。&lt;/p&gt;

&lt;p&gt;由于防火墙的原因，我们并不能直接访问谷歌，那么我们可以借助VPN来实现，这就是一个简单的正向代理的例子。这里你能够发现，正向代理“代理”的是客户端，而且客户端是知道目标的，而目标是不知道客户端是通过VPN访问的。&lt;/p&gt;

&lt;p&gt;当我们在外网访问百度的时候，其实会进行一个转发，代理到内网去，这就是所谓的反向代理，即反向代理“代理”的是服务器端，而且这一个过程对于客户端而言是透明的。&lt;/p&gt;

&lt;p&gt;当我们访问web时候，前端会通过nginx 反向代理到后端服务器，并将请求结果返回给前端，前端返回给用户。这就是反向代理。&lt;/p&gt;

&lt;h4 id=&quot;其他功能&quot;&gt;其他功能&lt;/h4&gt;

&lt;p&gt;负载均衡【upstream】&lt;/p&gt;

&lt;p&gt;缓存，可以加快访问速度的机制，说白了，在配置上就是一个开启，同时指定目录，让缓存可以存储到磁盘上。&lt;/p&gt;

&lt;h4 id=&quot;example&quot;&gt;Example&lt;/h4&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;
&lt;span class=&quot;c&quot;&gt;#失败重试机制设置,当upstream里第一台server出现502，自动转入第二台；&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#使用uwsgi时不需要设置&lt;/span&gt;
proxy_next_upstream http_502&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#nginx请求后台的超时时间，若是后台某个服务处理时间超过60s,则uwsgi关闭连接，返回超时，但是后台仍将请求执行结束；&lt;/span&gt;
uwsgi_read_timeout 60&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#uwsgi失败重试机制设置,当upstream里第一台server出现error，自动转入第二台；&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#默认为uwsgi_next_upstream error timeout；&lt;/span&gt;
uwsgi_next_upstream error&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#配置后台服务器，默认第一台执行&lt;/span&gt;
upstream uwsgi_server &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$SERVER1&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$SERVER2&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#配置log路径&lt;/span&gt;
access_log  /var/log/nginx/SchoolBuy_access.log&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
error_log   /var/log/nginx/SchoolBuy_error.log&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#配置80端口，http,进入前端界面&lt;/span&gt;
server &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    listen 80&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    server_name proxy&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# rewrite ^(.*) https://$PROXY\$1 permanent;&lt;/span&gt;
    location / &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        root /usr/share/nginx/html&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#配置443端口，https，进入后台https请求，uwsgi_pass至后台服务；&lt;/span&gt;
server &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    listen 443 ssl default&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    server_name proxy&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    ssl_certificate /etc/nginx/nginx.crt&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    ssl_certificate_key /etc/nginx/nginx.key&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    ssl_ciphers &lt;span class=&quot;s2&quot;&gt;&quot;HIGH:!aNULL:!MD5 or HIGH:!aNULL:!MD5:!3DES&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    ssl_prefer_server_ciphers on&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    charset utf-8&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;#最大上传200M文件&lt;/span&gt;
    client_max_body_size 200M&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    location /static &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        root /usr/share/nginx/html&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    location / &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;#设置跨域&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\$&lt;/span&gt;cors &lt;span class=&quot;s2&quot;&gt;&quot;allow&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\$&lt;/span&gt;request_method &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;OPTIONS&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\$&lt;/span&gt;cors &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\$&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;{cors}options&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\$&lt;/span&gt;cors &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;allowoptions&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            add_header &lt;span class=&quot;s1&quot;&gt;'Access-Control-Allow-Origin'&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\$&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;http_origin&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            add_header &lt;span class=&quot;s1&quot;&gt;'Access-Control-Allow-Credentials'&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;true&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            add_header &lt;span class=&quot;s1&quot;&gt;'Access-Control-Max-Age'&lt;/span&gt; 86400&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            add_header &lt;span class=&quot;s1&quot;&gt;'Access-Control-Allow-Methods'&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'GET, POST, OPTIONS, DELETE'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            add_header &lt;span class=&quot;s1&quot;&gt;'Access-Control-Allow-Headers'&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'reqid, nid, host, x-real-ip, x-forwarded-ip, event-type, event-id, accept, content-type'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            add_header &lt;span class=&quot;s1&quot;&gt;'Content-Length'&lt;/span&gt; 0&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            add_header &lt;span class=&quot;s1&quot;&gt;'Content-Type'&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'text/plain, charset=utf-8'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return &lt;/span&gt;200&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        
        &lt;span class=&quot;c&quot;&gt;#nginx设置当前服务器为代理服务器，支持uwsgi协议，向后台请求&lt;/span&gt;
        uwsgi_pass uwsgi_server&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        include     /etc/nginx/conf/uwsgi_params&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;c&quot;&gt;#Proxy Settings，配置了uwsgi可不用&lt;/span&gt;
        proxy_redirect off&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        proxy_set_header Host &lt;span class=&quot;se&quot;&gt;\$&lt;/span&gt;host&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        proxy_set_header X-Real-IP &lt;span class=&quot;se&quot;&gt;\$&lt;/span&gt;remote_addr&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        proxy_set_header X-Forwarded-For &lt;span class=&quot;se&quot;&gt;\$&lt;/span&gt;proxy_add_x_forwarded_for&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        proxy_next_upstream error &lt;span class=&quot;nb&quot;&gt;timeout &lt;/span&gt;invalid_header http_500 http_502 http_503 http_504&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        proxy_max_temp_file_size 0&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        proxy_connect_timeout 90&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        proxy_send_timeout 90&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        proxy_read_timeout 90&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        proxy_buffer_size 4k&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        proxy_buffers 4 32k&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        proxy_busy_buffers_size 64k&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        proxy_temp_file_write_size 64k&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;当后台服务超时，uwsgi关闭与nginx连接时，会自动向第二个后台发送请求，这就导致了一个请求，两次运行，设置uwsgi_next_upstream error(默认uwsgi_next_upstream error timeout)，这样超时后就不会再向第二个后台发送请求。&lt;/p&gt;
</description>
        <pubDate>Sun, 24 Jun 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2018/06/24/nginx/</link>
        <guid isPermaLink="true">http://localhost:4000/2018/06/24/nginx/</guid>
        
        <category>ENV</category>
        
        <category>Skill</category>
        
        
      </item>
    
      <item>
        <title>work experience ppts</title>
        <description>&lt;p&gt;I want to list my work ppts in recent two years.
those ppts is just for letting teammates know about some skills that i know,so  they are not formal.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;jenkins&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/assets/ppts/jenkins.key&quot;&gt;jenkins.key&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;elasticsearch&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/assets/ppts/elasticsearch.pptx&quot;&gt;elasticsearch.pptx&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;wechat littleprogram&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/assets/ppts/littleprogram.pptx&quot;&gt;littleprogram.pptx&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;airflow&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/assets/ppts/jenkins-airflow.ppt&quot;&gt;jenkins-airflow.ppt&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;jmeter&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/assets/ppts/jmeter.pptx&quot;&gt;jmeter.pptx&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;面向高级编程&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/assets/ppts/ 面向对象高级编程.pptx&quot;&gt; 面向对象高级编程.pptx&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;敏捷开发&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/assets/ppts/敏捷开发.ppt&quot;&gt;敏捷开发.ppt&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;django&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/assets/ppts/Django.pptx&quot;&gt;Django.pptx&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;software requirement&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/assets/ppts/software requirement.pptx&quot;&gt;software requirement.pptx&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Thu, 07 Jun 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2018/06/07/work-ppts/</link>
        <guid isPermaLink="true">http://localhost:4000/2018/06/07/work-ppts/</guid>
        
        <category>Experience</category>
        
        
      </item>
    
      <item>
        <title>manage multiple ssh-keys</title>
        <description>&lt;h4 id=&quot;environment-config&quot;&gt;Environment config&lt;/h4&gt;

&lt;p&gt;when you start your work environment,manage mutilple ssh keys is important just like keep your home key safe,using mutilple ssh keys to match different systems,such as gitlab,github,personal keys,work keys.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;... .ssh]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ssh-keygen &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; rsa &lt;span class=&quot;nt&quot;&gt;-C&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;****&quot;&lt;/span&gt;
Generating public/private rsa key pair.
Enter file &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;which to save the key &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;/home/usbmount/.ssh/id_rsa&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: id_rsa_gitlab
Enter passphrase &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;empty &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;no passphrase&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:
Enter same passphrase again:
Your identification has been saved &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;id_rsa_gitlab.
Your public key has been saved &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;id_rsa_gitlab.pub.
The key fingerprint is:
3a:fe:c4:1c:48:af:2a:f1:a1:fb:94:21:b6:c1:23:54 &lt;span class=&quot;k&quot;&gt;***&lt;/span&gt;
The key&lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;s randomart image is:
+--[ RSA 2048]----+
|   E             |

▽
&lt;span class=&quot;c&quot;&gt;# gitlab&lt;/span&gt;
|  &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;              |
| &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;    &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;          |
|..   &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; o         |
|. &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; S        |
| o.&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;.o &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;       |
|  .+o.+ +        |
|  o..o o         |
|  .+o ...        |
+-----------------+


&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;... .ssh]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ssh-add id_rsa_gitlab
Identity added: id_rsa_gitlab &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;id_rsa_gitlab&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;


&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;... .ssh]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;vim config
&lt;span class=&quot;c&quot;&gt;# gitlab&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;#HOST can use regular expression&lt;/span&gt;
  HOST gitlab.&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;#HostName must match the Host regular expression,and without port&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;#if the host is ip address,you need add a &amp;lt;Port&amp;gt; param&lt;/span&gt;
  HostName &lt;span class=&quot;k&quot;&gt;****&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;#the prefer ssh auth mode&lt;/span&gt;
  PreferredAuthentications publickey
  IdentityFile ~/.ssh/id_rsa_gitlab
  User genetfp2

&lt;span class=&quot;c&quot;&gt;#github&lt;/span&gt;
  Host github
  HostName github.com
  IdentityFile ~/.ssh/id_rsa_github

&lt;span class=&quot;c&quot;&gt;#if there are many ssh keys,you are suggested to add the follow config to let password first,&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#because if ssh keys first,and match the all above keys failed,the auth times may be&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#greater than auth max-time,and then you cannot use password auth any more.&lt;/span&gt;
   Host &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;
   PubkeyAuthentication no
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;if you want add another,just do it again.&lt;/p&gt;
</description>
        <pubDate>Thu, 17 May 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2018/05/17/sshs/</link>
        <guid isPermaLink="true">http://localhost:4000/2018/05/17/sshs/</guid>
        
        <category>ENV</category>
        
        <category>Skill</category>
        
        
      </item>
    
      <item>
        <title>Fix git push error in pycharm or other IDE</title>
        <description>&lt;h4 id=&quot;the-error-detail&quot;&gt;The error detail:&lt;/h4&gt;
&lt;p&gt;you can git add,commit,push in terminal,but cannot push with IDE,the error info is &lt;code class=&quot;highlighter-rouge&quot;&gt;Could not read from remote repository&lt;/code&gt;;&lt;/p&gt;

&lt;h4 id=&quot;fix&quot;&gt;Fix:&lt;/h4&gt;
&lt;p&gt;open &lt;code class=&quot;highlighter-rouge&quot;&gt;Preference&lt;/code&gt; -&amp;gt; open &lt;code class=&quot;highlighter-rouge&quot;&gt;Version Control&lt;/code&gt; -&amp;gt; click &lt;code class=&quot;highlighter-rouge&quot;&gt;git&lt;/code&gt; -&amp;gt; select &lt;code class=&quot;highlighter-rouge&quot;&gt;SSH execute&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;Native&lt;/code&gt;.&lt;/p&gt;
</description>
        <pubDate>Mon, 14 May 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2018/05/14/git-error/</link>
        <guid isPermaLink="true">http://localhost:4000/2018/05/14/git-error/</guid>
        
        <category>ENV</category>
        
        <category>Skill</category>
        
        
      </item>
    
  </channel>
</rss>
